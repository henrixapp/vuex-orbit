'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _store = require('@orbit/store');

var _store2 = _interopRequireDefault(_store);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class VuexStore extends _store2.default {
    constructor(settings = {}) {
        super(settings);
        this.namespaced = false;
        if (settings.schema) {
            //generate vuex store
            this.state = this.state || {};
            Object.keys(this._schema.models).forEach(type => {
                let model = settings.schema.getModel(type);
                this.state = this.state || {};
                //add to state
                this.state[this._schema.singularize(type)] = model;
                this.state[this._schema.pluralize(type)] = [];
            });
            //map fields
            this.getters = {
                getField: state => {
                    return path => path.split(/[.[\]]+/).reduce((prev, key) => prev[key], state);
                }
            };
            this.actions = {
                //TODO: Add fetch settings like json api
                /**
                 * @argument model: The model as singularized name
                 */
                fetchAllOf: ({ commit }, model) => {
                    this.query(q => q.findRecords(model)).then(data => {
                        commit('set', { data, model: this._schema.pluralize(model) });
                    });
                },
                fetchOne: ({ commit }, { model, id }) => {
                    this.query(q => q.findRecord({ type: model, id })).then(data => commit('set', { data, model: this._schema.singularize(model) }));
                },
                update: ({ commit }, data) => {
                    this.update(t => t.replaceRecord(data)).then(() => commit('set', { data, model: data.type }));
                }
            };
            this.mutations = {
                set: (state, { data, model }) => {
                    state[model] = data;
                    if (model.lastIndexOf('s') !== model.length - 1) {
                        state[this.schema.pluralize(model)].forEach(item => {
                            if (item.id === data.id) {
                                item.attributes = data.attributes;
                                item.relationships = data.relationships;
                                item.keys = data.keys;
                            }
                        });
                    }
                },
                updateField: (state, { path, value }) => {
                    //set in field
                    path.split(/[.[\]]+/).reduce((prev, key, index, array) => {
                        if (array.length === index + 1) {
                            // eslint-disable-next-line no-param-reassign
                            prev[key] = value;
                        }
                        return prev[key];
                    }, state);
                }
            };
        }
    }
}
exports.default = VuexStore;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZ1ZXgtc3RvcmUuanMiXSwibmFtZXMiOlsiVnVleFN0b3JlIiwiU3RvcmUiLCJjb25zdHJ1Y3RvciIsInNldHRpbmdzIiwibmFtZXNwYWNlZCIsInNjaGVtYSIsInN0YXRlIiwiT2JqZWN0Iiwia2V5cyIsIl9zY2hlbWEiLCJtb2RlbHMiLCJmb3JFYWNoIiwidHlwZSIsIm1vZGVsIiwiZ2V0TW9kZWwiLCJzaW5ndWxhcml6ZSIsInBsdXJhbGl6ZSIsImdldHRlcnMiLCJnZXRGaWVsZCIsInBhdGgiLCJzcGxpdCIsInJlZHVjZSIsInByZXYiLCJrZXkiLCJhY3Rpb25zIiwiZmV0Y2hBbGxPZiIsImNvbW1pdCIsInF1ZXJ5IiwicSIsImZpbmRSZWNvcmRzIiwidGhlbiIsImRhdGEiLCJmZXRjaE9uZSIsImlkIiwiZmluZFJlY29yZCIsInVwZGF0ZSIsInQiLCJyZXBsYWNlUmVjb3JkIiwibXV0YXRpb25zIiwic2V0IiwibGFzdEluZGV4T2YiLCJsZW5ndGgiLCJpdGVtIiwiYXR0cmlidXRlcyIsInJlbGF0aW9uc2hpcHMiLCJ1cGRhdGVGaWVsZCIsInZhbHVlIiwiaW5kZXgiLCJhcnJheSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7Ozs7OztBQUNlLE1BQU1BLFNBQU4sU0FBd0JDLGVBQXhCLENBQThCO0FBQ3pDQyxnQkFBWUMsV0FBVyxFQUF2QixFQUEyQjtBQUN2QixjQUFNQSxRQUFOO0FBQ0EsYUFBS0MsVUFBTCxHQUFrQixLQUFsQjtBQUNBLFlBQUlELFNBQVNFLE1BQWIsRUFBcUI7QUFDakI7QUFDQSxpQkFBS0MsS0FBTCxHQUFhLEtBQUtBLEtBQUwsSUFBYyxFQUEzQjtBQUNBQyxtQkFBT0MsSUFBUCxDQUFZLEtBQUtDLE9BQUwsQ0FBYUMsTUFBekIsRUFBaUNDLE9BQWpDLENBQXlDQyxRQUFRO0FBQzdDLG9CQUFJQyxRQUFRVixTQUFTRSxNQUFULENBQWdCUyxRQUFoQixDQUF5QkYsSUFBekIsQ0FBWjtBQUNBLHFCQUFLTixLQUFMLEdBQWEsS0FB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LE1BQU1QLE1BQU4sS0FBaUJNLFFBQVEsQ0FBN0IsRUFBZ0M7QUFDNUI7QUFDQXpCLGlDQUFLQyxHQUFMLElBQVl1QixLQUFaO0FBQ0g7QUFDRCwrQkFBT3hCLEtBQUtDLEdBQUwsQ0FBUDtBQUNILHFCQU5ELEVBTUdqQixLQU5IO0FBT0g7QUF0QlksYUFBakI7QUF3Qkg7QUFDSjtBQTlEd0M7a0JBQXhCTixTIiwiZmlsZSI6InZ1ZXgtc3RvcmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgU3RvcmUgZnJvbSAnQG9yYml0L3N0b3JlJztcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFZ1ZXhTdG9yZSBleHRlbmRzIFN0b3JlIHtcbiAgICBjb25zdHJ1Y3RvcihzZXR0aW5ncyA9IHt9KSB7XG4gICAgICAgIHN1cGVyKHNldHRpbmdzKTtcbiAgICAgICAgdGhpcy5uYW1lc3BhY2VkID0gZmFsc2U7XG4gICAgICAgIGlmIChzZXR0aW5ncy5zY2hlbWEpIHtcbiAgICAgICAgICAgIC8vZ2VuZXJhdGUgdnVleCBzdG9yZVxuICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IHRoaXMuc3RhdGUgfHwge307XG4gICAgICAgICAgICBPYmplY3Qua2V5cyh0aGlzLl9zY2hlbWEubW9kZWxzKS5mb3JFYWNoKHR5cGUgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBtb2RlbCA9IHNldHRpbmdzLnNjaGVtYS5nZXRNb2RlbCh0eXBlKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlID0gdGhpcy5zdGF0ZSB8fCB7fTtcbiAgICAgICAgICAgICAgICAvL2FkZCB0byBzdGF0ZVxuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGVbdGhpcy5fc2NoZW1hLnNpbmd1bGFyaXplKHR5cGUpXSA9IG1vZGVsO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGVbdGhpcy5fc2NoZW1hLnBsdXJhbGl6ZSh0eXBlKV0gPSBbXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy9tYXAgZmllbGRzXG4gICAgICAgICAgICB0aGlzLmdldHRlcnMgPSB7XG4gICAgICAgICAgICAgICAgZ2V0RmllbGQ6IHN0YXRlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhdGggPT4gcGF0aC5zcGxpdCgvWy5bXFxdXSsvKS5yZWR1Y2UoKHByZXYsIGtleSkgPT4gcHJldltrZXldLCBzdGF0ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuYWN0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAvL1RPRE86IEFkZCBmZXRjaCBzZXR0aW5ncyBsaWtlIGpzb24gYXBpXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQGFyZ3VtZW50IG1vZGVsOiBUaGUgbW9kZWwgYXMgc2luZ3VsYXJpemVkIG5hbWVcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBmZXRjaEFsbE9mOiAoeyBjb21taXQgfSwgbW9kZWwpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5xdWVyeShxID0+IHEuZmluZFJlY29yZHMobW9kZWwpKS50aGVuKGRhdGEgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tbWl0KCdzZXQnLCB7IGRhdGEsIG1vZGVsOiB0aGlzLl9zY2hlbWEucGx1cmFsaXplKG1vZGVsKSB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBmZXRjaE9uZTogKHsgY29tbWl0IH0sIHsgbW9kZWwsIGlkIH0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5xdWVyeShxID0+IHEuZmluZFJlY29yZCh7IHR5cGU6IG1vZGVsLCBpZCB9KSkudGhlbihkYXRhID0+IGNvbW1pdCgnc2V0JywgeyBkYXRhLCBtb2RlbDogdGhpcy5fc2NoZW1hLnNpbmd1bGFyaXplKG1vZGVsKSB9KSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB1cGRhdGU6ICh7IGNvbW1pdCB9LCBkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlKHQgPT4gdC5yZXBsYWNlUmVjb3JkKGRhdGEpKS50aGVuKCgpID0+IGNvbW1pdCgnc2V0JywgeyBkYXRhLCBtb2RlbDogZGF0YS50eXBlIH0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5tdXRhdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgc2V0OiAoc3RhdGUsIHsgZGF0YSwgbW9kZWwgfSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzdGF0ZVttb2RlbF0gPSBkYXRhO1xuICAgICAgICAgICAgICAgICAgICBpZiAobW9kZWwubGFzdEluZGV4T2YoJ3MnKSAhPT0gbW9kZWwubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVbdGhpcy5zY2hlbWEucGx1cmFsaXplKG1vZGVsKV0uZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5pZCA9PT0gZGF0YS5pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmF0dHJpYnV0ZXMgPSBkYXRhLmF0dHJpYnV0ZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ucmVsYXRpb25zaGlwcyA9IGRhdGEucmVsYXRpb25zaGlwcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5rZXlzID0gZGF0YS5rZXlzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB1cGRhdGVGaWVsZDogKHN0YXRlLCB7IHBhdGgsIHZhbHVlIH0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy9zZXQgaW4gZmllbGRcbiAgICAgICAgICAgICAgICAgICAgcGF0aC5zcGxpdCgvWy5bXFxdXSsvKS5yZWR1Y2UoKHByZXYsIGtleSwgaW5kZXgsIGFycmF5KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJyYXkubGVuZ3RoID09PSBpbmRleCArIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2W2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwcmV2W2tleV07XG4gICAgICAgICAgICAgICAgICAgIH0sIHN0YXRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxufSJdfQ==