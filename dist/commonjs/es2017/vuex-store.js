'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _store = require('@orbit/store');

var _store2 = _interopRequireDefault(_store);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class VuexStore extends _store2.default {
    constructor(settings = {}) {
        super(settings);
        this.namespaced = false;
        if (settings.schema) {
            //generate vuex store
            this.state = this.state || {};
            Object.keys(this._schema.models).forEach(type => {
                let model = settings.schema.getModel(type);
                this.state = this.state || {};
                //add to state
                this.state[this._schema.singularize(type)] = model;
                this.state[this._schema.pluralize(type)] = [];
            });
            //map fields
            this.getters = {
                getField: state => {
                    return path => path.split(/[.[\]]+/).reduce((prev, key) => prev[key], state);
                }
            };
            this.actions = {
                //TODO: Add fetch settings like json api
                /**
                 * @argument model: The model as singularized name
                 */
                fetchAllOf: ({ commit }, model) => {
                    this.query(q => q.findRecords(model)).then(data => {
                        commit('set', { data, model: this._schema.pluralize(model) });
                    });
                },
                fetchAllRelatedOf: ({ commit }, query) => {
                    this.query(q => q.findRelatedRecords(query.data, query.relationship)).then(data => {
                        commit('set', { data, model: query.relationship });
                    });
                },
                fetchRelatedOf: ({ commit }, query) => {
                    this.query(q => q.findRelatedRecord(query.data, query.relationship)).then(data => {
                        commit('set', { data, model: query.relationship });
                    });
                },
                fetchOne: ({ commit }, { model, id }) => {
                    this.query(q => q.findRecord({ type: model, id })).then(data => commit('set', { data, model: this._schema.singularize(model) }));
                },
                update: ({ commit }, data) => {
                    this.update(t => t.replaceRecord(data)).then(() => commit('set', { data, model: data.type }));
                },
                delete: ({ commit, dispatch }, data) => {
                    this.update(t => t.removeRecord(data)).then(() => {
                        //update
                        dispatch("fetchAllOf", data.type);
                    });
                }
                //TODO: RelatedRecords update and delete
            };
            this.mutations = {
                set: (state, { data, model }) => {
                    state[model] = data;
                    if (model.lastIndexOf('s') !== model.length - 1) {
                        state[this.schema.pluralize(model)].forEach(item => {
                            if (item.id === data.id) {
                                item.attributes = data.attributes;
                                item.relationships = data.relationships;
                                item.keys = data.keys;
                            }
                        });
                    }
                },
                updateField: (state, { path, value }) => {
                    //set in field
                    path.split(/[.[\]]+/).reduce((prev, key, index, array) => {
                        if (array.length === index + 1) {
                            // eslint-disable-next-line no-param-reassign
                            prev[key] = value;
                        }
                        return prev[key];
                    }, state);
                }
            };
        }
    }
}
exports.default = VuexStore;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZ1ZXgtc3RvcmUuanMiXSwibmFtZXMiOlsiVnVleFN0b3JlIiwiU3RvcmUiLCJjb25zdHJ1Y3RvciIsInNldHRpbmdzIiwibmFtZXNwYWNlZCIsInNjaGVtYSIsInN0YXRlIiwiT2JqZWN0Iiwia2V5cyIsIl9zY2hlbWEiLCJtb2RlbHMiLCJmb3JFYWNoIiwidHlwZSIsIm1vZGVsIiwiZ2V0TW9kZWwiLCJzaW5ndWxhcml6ZSIsInBsdXJhbGl6ZSIsImdldHRlcnMiLCJnZXRGaWVsZCIsInBhdGgiLCJzcGxpdCIsInJlZHVjZSIsInByZXYiLCJrZXkiLCJhY3Rpb25zIiwiZmV0Y2hBbGxPZiIsImNvbW1pdCIsInF1ZXJ5IiwicSIsImZpbmRSZWNvcmRzIiwidGhlbiIsImRhdGEiLCJmZXRjaEFsbFJlbGF0ZWRPZiIsImZpbmRSZWxhdGVkUmVjb3JkcyIsInJlbGF0aW9uc2hpcCIsImZldGNoUmVsYXRlZE9mIiwiZmluZFJlbGF0ZWRSZWNvcmQiLCJmZXRjaE9uZSIsImlkIiwiZmluZFJlY29yZCIsInVwZGF0ZSIsInQiLCJyZXBsYWNlUmVjb3JkIiwiZGVsZXRlIiwiZGlzcGF0Y2giLCJyZW1vdmVSZWNvcmQiLCJtdXRhdGlvbnMiLCJzZXQiLCJsYXN0SW5kZXhPZiIsImxlbmd0aCIsIml0ZW0iLCJhdHRyaWJ1dGVzIiwicmVsYXRpb25zaGlwcyIsInVwZGF0ZUZpZWxkIiwidmFsdWUiLCJpbmRleCIsImFycmF5Il0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7Ozs7O0FBQ2UsTUFBTUEsU0FBTixTQUF3QkMsZUFBeEIsQ0FBOEI7QUFDekNDLGdCQUFZQyxXQUFXLEVBQXZCLEVBQTJCO0FBQ3ZCLGNBQU1BLFFBQU47QUFDQSxhQUFLQyxVQUFMLEdBQWtCLEtBQWxCO0FBQ0EsWUFBSUQsU0FBU0UsTUFBYixFQUFxQjtBQUNqQjtBQUNBLGlCQUFLQyxLQUFMLEdBQWEsS0FBS0EsS0FBTCxJQUFjLEVBQTNCO0FBQ0FDLG1CQUFPQyxJQUFQLENBQVksS0FBS0Ms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QyxpQ0FBS0MsR0FBTCxJQUFZK0IsS0FBWjtBQUNIO0FBQ0QsK0JBQU9oQyxLQUFLQyxHQUFMLENBQVA7QUFDSCxxQkFORCxFQU1HakIsS0FOSDtBQU9IO0FBdEJZLGFBQWpCO0FBd0JIO0FBQ0o7QUEvRXdDO2tCQUF4Qk4sUyIsImZpbGUiOiJ2dWV4LXN0b3JlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFN0b3JlIGZyb20gJ0BvcmJpdC9zdG9yZSc7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBWdWV4U3RvcmUgZXh0ZW5kcyBTdG9yZSB7XG4gICAgY29uc3RydWN0b3Ioc2V0dGluZ3MgPSB7fSkge1xuICAgICAgICBzdXBlcihzZXR0aW5ncyk7XG4gICAgICAgIHRoaXMubmFtZXNwYWNlZCA9IGZhbHNlO1xuICAgICAgICBpZiAoc2V0dGluZ3Muc2NoZW1hKSB7XG4gICAgICAgICAgICAvL2dlbmVyYXRlIHZ1ZXggc3RvcmVcbiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSB0aGlzLnN0YXRlIHx8IHt9O1xuICAgICAgICAgICAgT2JqZWN0LmtleXModGhpcy5fc2NoZW1hLm1vZGVscykuZm9yRWFjaCh0eXBlID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgbW9kZWwgPSBzZXR0aW5ncy5zY2hlbWEuZ2V0TW9kZWwodHlwZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IHRoaXMuc3RhdGUgfHwge307XG4gICAgICAgICAgICAgICAgLy9hZGQgdG8gc3RhdGVcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlW3RoaXMuX3NjaGVtYS5zaW5ndWxhcml6ZSh0eXBlKV0gPSBtb2RlbDtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlW3RoaXMuX3NjaGVtYS5wbHVyYWxpemUodHlwZSldID0gW107XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vbWFwIGZpZWxkc1xuICAgICAgICAgICAgdGhpcy5nZXR0ZXJzID0ge1xuICAgICAgICAgICAgICAgIGdldEZpZWxkOiBzdGF0ZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXRoID0+IHBhdGguc3BsaXQoL1suW1xcXV0rLykucmVkdWNlKChwcmV2LCBrZXkpID0+IHByZXZba2V5XSwgc3RhdGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLmFjdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgLy9UT0RPOiBBZGQgZmV0Y2ggc2V0dGluZ3MgbGlrZSBqc29uIGFwaVxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEBhcmd1bWVudCBtb2RlbDogVGhlIG1vZGVsIGFzIHNpbmd1bGFyaXplZCBuYW1lXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgZmV0Y2hBbGxPZjogKHsgY29tbWl0IH0sIG1vZGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucXVlcnkocSA9PiBxLmZpbmRSZWNvcmRzKG1vZGVsKSkudGhlbihkYXRhID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1pdCgnc2V0JywgeyBkYXRhLCBtb2RlbDogdGhpcy5fc2NoZW1hLnBsdXJhbGl6ZShtb2RlbCkgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZmV0Y2hBbGxSZWxhdGVkT2Y6ICh7IGNvbW1pdCB9LCBxdWVyeSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5KHEgPT4gcS5maW5kUmVsYXRlZFJlY29yZHMocXVlcnkuZGF0YSwgcXVlcnkucmVsYXRpb25zaGlwKSkudGhlbihkYXRhID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1pdCgnc2V0JywgeyBkYXRhLCBtb2RlbDogcXVlcnkucmVsYXRpb25zaGlwIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZldGNoUmVsYXRlZE9mOiAoeyBjb21taXQgfSwgcXVlcnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5xdWVyeShxID0+IHEuZmluZFJlbGF0ZWRSZWNvcmQocXVlcnkuZGF0YSwgcXVlcnkucmVsYXRpb25zaGlwKSkudGhlbihkYXRhID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1pdCgnc2V0JywgeyBkYXRhLCBtb2RlbDogcXVlcnkucmVsYXRpb25zaGlwIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZldGNoT25lOiAoeyBjb21taXQgfSwgeyBtb2RlbCwgaWQgfSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5KHEgPT4gcS5maW5kUmVjb3JkKHsgdHlwZTogbW9kZWwsIGlkIH0pKS50aGVuKGRhdGEgPT4gY29tbWl0KCdzZXQnLCB7IGRhdGEsIG1vZGVsOiB0aGlzLl9zY2hlbWEuc2luZ3VsYXJpemUobW9kZWwpIH0pKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHVwZGF0ZTogKHsgY29tbWl0IH0sIGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGUodCA9PiB0LnJlcGxhY2VSZWNvcmQoZGF0YSkpLnRoZW4oKCkgPT4gY29tbWl0KCdzZXQnLCB7IGRhdGEsIG1vZGVsOiBkYXRhLnR5cGUgfSkpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGVsZXRlOiAoeyBjb21taXQsIGRpc3BhdGNoIH0sIGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGUodCA9PiB0LnJlbW92ZVJlY29yZChkYXRhKSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL3VwZGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2goXCJmZXRjaEFsbE9mXCIsIGRhdGEudHlwZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvL1RPRE86IFJlbGF0ZWRSZWNvcmRzIHVwZGF0ZSBhbmQgZGVsZXRlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5tdXRhdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgc2V0OiAoc3RhdGUsIHsgZGF0YSwgbW9kZWwgfSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzdGF0ZVttb2RlbF0gPSBkYXRhO1xuICAgICAgICAgICAgICAgICAgICBpZiAobW9kZWwubGFzdEluZGV4T2YoJ3MnKSAhPT0gbW9kZWwubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVbdGhpcy5zY2hlbWEucGx1cmFsaXplKG1vZGVsKV0uZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5pZCA9PT0gZGF0YS5pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmF0dHJpYnV0ZXMgPSBkYXRhLmF0dHJpYnV0ZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ucmVsYXRpb25zaGlwcyA9IGRhdGEucmVsYXRpb25zaGlwcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5rZXlzID0gZGF0YS5rZXlzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB1cGRhdGVGaWVsZDogKHN0YXRlLCB7IHBhdGgsIHZhbHVlIH0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy9zZXQgaW4gZmllbGRcbiAgICAgICAgICAgICAgICAgICAgcGF0aC5zcGxpdCgvWy5bXFxdXSsvKS5yZWR1Y2UoKHByZXYsIGtleSwgaW5kZXgsIGFycmF5KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJyYXkubGVuZ3RoID09PSBpbmRleCArIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2W2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwcmV2W2tleV07XG4gICAgICAgICAgICAgICAgICAgIH0sIHN0YXRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxufSJdfQ==